{"version":3,"sources":["../scripts.babel/popup.js"],"names":[],"mappings":"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","file":"popup.js","sourcesContent":["/* global $, Fuse */\n'use strict';\n\nclass Tabber {\n\n    constructor() {\n       this.input = $('.input input');\n       this.container = $('.tab-list');\n       this.cloneTabItem = this.container.children('.tab.source');\n\n       // Get initial tabs\n       this.getTabs(true);\n\n       // Set key bindings\n       var self = this;\n       this.input.on('keydown', function(e) {\n           self.onKeyDown(e);\n       });\n       this.input.on('keyup', function(e) {\n           self.onKeyUp(e);\n       });\n   }\n\n    renderTabs(list) {\n        var self = this;\n\n        // Restart index\n        this.selectedIndex = 0;\n        this.listLength = list.length;\n\n        // Remove all previous items\n        this.container.children('.tab').not('.source').remove();\n\n        // Clone and append item for each open tab\n        for (var i = 0, total = list.length; i < total; i++) {\n            var t = this.cloneTabItem.clone();\n            t.removeClass('source');\n            t.children('.icon').css('background-image', 'url(' + list[i].favIconUrl + ')');\n            t.children('.title').text(list[i].title);\n            t.children('.url').text(list[i].url);\n\n            // Add class if pinned\n            if (list[i].pinned) {\n                t.addClass('pinned');\n            }\n            // Add class if incognito\n            if (list[i].incognito) {\n                t.addClass('incognito');\n            }\n\n            // Save index and window data\n            t.data('index', list[i].index);\n            t.data('window', list[i].windowId);\n\n            // Click event\n            t.on('click', function(e) {\n                self.clickTab(e);\n            });\n\n            // Hover event\n            t.on('mouseover', function(e) {\n                self.hoverTab(e);\n            });\n\n            t.appendTo(this.container);\n        }\n\n        // Add class when no results\n        this.container[total === 0 ? 'addClass' : 'removeClass']('no-results');\n\n        this.updateSelected();\n    }\n\n    getTabs(first) {\n        var self = this;\n        chrome.tabs.query({}, function(tabs) {\n            self.tabList = tabs;\n\n            // Set fuse search\n            self.fuse = new Fuse(tabs, {\n                keys: ['title','url']\n            });\n\n            if (first) {\n                self.renderTabs(tabs);\n            }\n        });\n    }\n\n    searchTabs(q) {\n        var filteredList;\n        if (q === undefined || q === null || q === '') {\n            filteredList = this.tabList;\n        } else {\n            filteredList = this.fuse.search(q);\n        }\n        this.renderTabs(filteredList);\n    }\n\n    updateSelected() {\n        var tabItems = this.container.children('.tab').not('.source');\n        tabItems.removeClass('selected');\n\n        if (this.selectedIndex >= 0) {\n            var item = tabItems.eq(this.selectedIndex);\n\n            // Update class\n            item.addClass('selected');\n\n            // Make sure item is visible\n            if (!this.isScrolledIntoView(item, this.container)) {\n                this.scrollToElement(item, this.container);\n            }\n        }\n    }\n\n    selectNext() {\n        if (this.selectedIndex < this.listLength - 1) {\n            this.selectedIndex += 1;\n        } else {\n            this.selectedIndex = 0;\n        }\n        this.updateSelected();\n    }\n\n    selectPrev() {\n        if (this.selectedIndex > 0) {\n            this.selectedIndex -= 1;\n        } else {\n            this.selectedIndex = this.listLength - 1;\n        }\n        this.updateSelected();\n    }\n\n    clear() {\n        // If already empty, close popup\n        if (this.input.val() === '') {\n            // To close it, we need to focus active window and tab\n            chrome.tabs.query({\n                active: true,\n                currentWindow: true\n            }, function(tab) {\n                chrome.windows.update(tab[0].windowId, {\n                    focused: true\n                }, function() {\n                    chrome.tabs.highlight({\n                        windowId: tab[0].windowId,\n                        tabs: tab[0].index\n                    });\n                });\n            });\n            return;\n        }\n\n        this.input.val('');\n        this.searchTabs();\n    }\n\n    highlightTab(tab) {\n        chrome.windows.update(tab.data('window'), {\n            focused: true\n        }, function() {\n            chrome.tabs.highlight({\n                windowId: tab.data('window'),\n                tabs: tab.data('index')\n            });\n        });\n    }\n\n    clickTab(e) {\n        var tab = $(e.currentTarget);\n        this.highlightTab(tab);\n    }\n\n    hoverTab(e) {\n        var tab = $(e.currentTarget),\n            index = this.container.children('.tab').not('.source').index(tab);\n\n        this.selectedIndex = index;\n        this.updateSelected();\n    }\n\n    goToSelectedTab() {\n        var allTabs = this.container.children('.tab').not('.source'),\n            selectedTab = allTabs.eq(this.selectedIndex);\n\n        if (selectedTab.length) {\n            this.highlightTab(selectedTab);\n        }\n    }\n\n    isScrolledIntoView(el, parent) {\n        var parentTop = parent.offset().top,\n            parentBottom = parentTop + parent.height(),\n            elemTop = el.offset().top,\n            elemBottom = elemTop + el.outerHeight();\n\n        return (elemBottom <= parentBottom) && (elemTop >= parentTop);\n    }\n\n    scrollToElement(el, parent) {\n        var parentTop = parent.offset().top,\n            parentBottom = parentTop + parent.height(),\n            elTop = el.offset().top,\n            elBottom = elTop + el.outerHeight(),\n            pos;\n\n        if (elBottom > parentBottom) {\n            pos = parent.scrollTop() + (elBottom - parentBottom);\n        } else {\n            pos = parent.scrollTop() - (parentTop - elTop);\n        }\n\n        parent.scrollTop(pos);\n    }\n\n    onKeyDown(e) {\n        switch (e.keyCode) {\n            // Esc\n            case 27:\n                e.preventDefault();\n                this.clear();\n                break;\n            // Enter\n            case 13:\n                e.preventDefault();\n                this.goToSelectedTab();\n                break;\n            // Up\n            case 38:\n                e.preventDefault();\n                this.selectPrev();\n                break;\n            // Down\n            case 40:\n                e.preventDefault();\n                this.selectNext();\n                break;\n        }\n    }\n\n    onKeyUp(e) {\n        switch (e.keyCode) {\n            case 13:\n            case 27:\n            case 38:\n            case 40:\n                break;\n            default:\n                this.searchTabs(e.target.value);\n        }\n    }\n}\n\nnew Tabber();\n"]}